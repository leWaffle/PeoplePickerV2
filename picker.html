<!DOCTYPE html>
<html lang="en">
   <head>
      <!-- Inspired by http://desandro.github.io/3dtransforms/docs/carousel.html -->
      <link href='http://fonts.googleapis.com/css?family=Titillium+Web' rel='stylesheet' type='text/css'>

      <meta charset="utf-8">
      <title>PeoplePickerv2</title>
      <style media="screen">
      html {
         font-family: 'Titillium Web', sans-serif;
      }
      #force-wrapper {
         position: absolute;
         top:50%;
         left:50%;
         height: 550px;
         width: 300px;
         margin: -27px 0px 0px -150px;
         border: 1px solid;
      }

      body {
         -moz-user-select: none;
         -khtml-user-select: none;
         -webkit-user-select: none;
         user-select: none;
      }

      /*css transition curve that sloves towards the end*/

      /* Use three different style of css easing functions to create different animations
         undershoot
         perfect
         overshoot
         
         */
      figure {
         overflow: hidden;
         margin: 0px;
      }


      .animation1 #carousel {
         /* exponential transition */
-webkit-transition: all 3000ms cubic-bezier(0.000, 1.000, 0.440, 1); /* older webkit */
-webkit-transition: all 3000ms cubic-bezier(0.000, 1.000, 0.440, 1.005);
   -moz-transition: all 3000ms cubic-bezier(0.000, 1.000, 0.440, 1.005);
    -ms-transition: all 3000ms cubic-bezier(0.000, 1.000, 0.440, 1.005);
     -o-transition: all 3000ms cubic-bezier(0.000, 1.000, 0.440, 1.005);
        transition: all 3000ms cubic-bezier(0.000, 1.000, 0.440, 1.005); /* custom */

-webkit-transition-timing-function: cubic-bezier(0.000, 1.000, 0.440, 1); /* older webkit */
-webkit-transition-timing-function: cubic-bezier(0.000, 1.000, 0.440, 1.005);
   -moz-transition-timing-function: cubic-bezier(0.000, 1.000, 0.440, 1.005);
    -ms-transition-timing-function: cubic-bezier(0.000, 1.000, 0.440, 1.005);
     -o-transition-timing-function: cubic-bezier(0.000, 1.000, 0.440, 1.005);
        transition-timing-function: cubic-bezier(0.000, 1.000, 0.440, 1.005); /* custom */
      }

      .animation2 #carousel {
         /*undertranssition*/
-webkit-transition: all 3000ms cubic-bezier(0.000, 1.000, 1.000, 0.430);
   -moz-transition: all 3000ms cubic-bezier(0.000, 1.000, 1.000, 0.430);
    -ms-transition: all 3000ms cubic-bezier(0.000, 1.000, 1.000, 0.430);
     -o-transition: all 3000ms cubic-bezier(0.000, 1.000, 1.000, 0.430);
        transition: all 3000ms cubic-bezier(0.000, 1.000, 1.000, 0.430); /* custom */

-webkit-transition-timing-function: cubic-bezier(0.000, 1.000, 1.000, 0.430);
   -moz-transition-timing-function: cubic-bezier(0.000, 1.000, 1.000, 0.430);
    -ms-transition-timing-function: cubic-bezier(0.000, 1.000, 1.000, 0.430);
     -o-transition-timing-function: cubic-bezier(0.000, 1.000, 1.000, 0.430);
        transition-timing-function: cubic-bezier(0.000, 1.000, 1.000, 0.430); /* custom */
      }

      .animation3 #carousel {
         /*overtransition */
/*-webkit-transition: all 3000ms cubic-bezier(0.000, 0.860, 0.660, 1); 
-webkit-transition: all 3000ms cubic-bezier(0.000, 0.860, 0.660, 1.650); 
   -moz-transition: all 3000ms cubic-bezier(0.000, 0.860, 0.660, 1.650); 
    -ms-transition: all 3000ms cubic-bezier(0.000, 0.860, 0.660, 1.650); 
     -o-transition: all 3000ms cubic-bezier(0.000, 0.860, 0.660, 1.650); 
        transition: all 3000ms cubic-bezier(0.000, 0.860, 0.660, 1.650); 

-webkit-transition-timing-function: cubic-bezier(0.000, 0.860, 0.660, 1); 
-webkit-transition-timing-function: cubic-bezier(0.000, 0.860, 0.660, 1.650); 
   -moz-transition-timing-function: cubic-bezier(0.000, 0.860, 0.660, 1.650); 
    -ms-transition-timing-function: cubic-bezier(0.000, 0.860, 0.660, 1.650); 
     -o-transition-timing-function: cubic-bezier(0.000, 0.860, 0.660, 1.650); 
        transition-timing-function: cubic-bezier(0.000, 0.860, 0.660, 1.650); */

        -webkit-transition: all 3000ms cubic-bezier(0.515, 0.675, 0.800, 0); /* older webkit */
-webkit-transition: all 3000ms cubic-bezier(0.515, 0.675, 0.800, -0.035); 
   -moz-transition: all 3000ms cubic-bezier(0.515, 0.675, 0.800, -0.035); 
    -ms-transition: all 3000ms cubic-bezier(0.515, 0.675, 0.800, -0.035); 
     -o-transition: all 3000ms cubic-bezier(0.515, 0.675, 0.800, -0.035); 
        transition: all 3000ms cubic-bezier(0.515, 0.675, 0.800, -0.035); /* custom */

-webkit-transition-timing-function: cubic-bezier(0.515, 0.675, 0.800, 0); /* older webkit */
-webkit-transition-timing-function: cubic-bezier(0.515, 0.675, 0.800, -0.035); 
   -moz-transition-timing-function: cubic-bezier(0.515, 0.675, 0.800, -0.035); 
    -ms-transition-timing-function: cubic-bezier(0.515, 0.675, 0.800, -0.035); 
     -o-transition-timing-function: cubic-bezier(0.515, 0.675, 0.800, -0.035); 
        transition-timing-function: cubic-bezier(0.515, 0.675, 0.800, -0.035); /* custom */
      }

      </style>

      <style media="screen">

    .container {
      width: 260px;
      height: 210px;
      position: relative;
      margin: calc(50% - 420px) auto;
      border: 1px solid #CCC;
      -webkit-perspective: 1100px;
         -moz-perspective: 1100px;
           -o-perspective: 1100px;
              perspective: 1100px;
    }


    #carousel {
      width: 100%;
      height: 100%;
      position: absolute;
      -webkit-transform-style: preserve-3d;
         -moz-transform-style: preserve-3d;
           -o-transform-style: preserve-3d;
              transform-style: preserve-3d;
    }

    .ready #carousel {
      -webkit-transition: -webkit-transform 1s;
         -moz-transition: -moz-transform 1s;
           -o-transition: -o-transform 1s;
              transition: transform 1s;
    }

    #carousel.panels-backface-invisible figure {
      -webkit-backface-visibility: hidden;
         -moz-backface-visibility: hidden;
           -o-backface-visibility: hidden;
              backface-visibility: hidden;
    }

    #carousel figure, #carousel div {
      display: block;
      position: absolute;
      width: 260px;
      height: 210px;
      border: 2px solid black;
      font-size: 80px;
      line-height: 210px;
      font-weight: bold;
      color: white;
      text-align: center;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .ready #carousel figure {
      -webkit-transition: opacity 1s, -webkit-transform 1s;
         -moz-transition: opacity 1s, -moz-transform 1s;
           -o-transition: opacity 1s, -o-transform 1s;
              transition: opacity 1s, transform 1s;
    }

  </style>
   </head>
   <body class="animation3">
      <h1>People Picker</h1>
      <h3>a.k.a Objective is Right!</h3>

      <!-- <div id="force-wrapper"></div> -->


      <section id="container" class="container">
<!--         <div id="carousel" style="-webkit-transform: translateZ(-288px) rotateX(0deg);">
         <figure style="opacity: 1; background-color: rgba(255, 0, 0, 0.8); -webkit-transform: rotateX(0deg) translateZ(288px);">This is a long pice of text that will make it hard to keep this on one line and will most likelyneed to be elipsed</figure>
         <div style="opacity: 1; background-color: rgba(255, 170, 0, 0.8); -webkit-transform: rotateX(40deg) translateZ(288px);">2</div>
         <figure style="opacity: 1; background-color: rgba(170, 255, 0, 0.8); -webkit-transform: rotateX(80deg) translateZ(288px);">3</figure>
         <figure style="opacity: 1; background-color: rgba(0, 255, 0, 0.8); -webkit-transform: rotateX(120deg) translateZ(288px);">4</figure>
         <figure style="opacity: 1; background-color: rgba(0, 255, 170, 0.8); -webkit-transform: rotateX(160deg) translateZ(288px);">5</figure>
         <figure style="opacity: 1; background-color: rgba(0, 170, 255, 0.8); -webkit-transform: rotateX(200deg) translateZ(288px);">6</figure>
         <figure style="opacity: 1; background-color: rgba(0, 0, 255, 0.8); -webkit-transform: rotateX(240deg) translateZ(288px);">7</figure>
         <figure style="opacity: 1; background-color: rgba(170, 0, 255, 0.8); -webkit-transform: rotateX(280deg) translateZ(288px);">8</figure>
         <figure style="opacity: 1; background-color: rgba(255, 0, 170, 0.8); -webkit-transform: rotateX(320deg) translateZ(288px);">9</figure>
         <figure style="opacity: 0; -webkit-transform: none;">10</figure>
         <figure style="opacity: 0; -webkit-transform: none;">11</figure>
         <figure style="opacity: 0; -webkit-transform: none;">12</figure>
         <figure style="opacity: 0; -webkit-transform: none;">13</figure>
         <figure style="opacity: 0; -webkit-transform: none;">14</figure>
         <figure style="opacity: 0; -webkit-transform: none;">15</figure>
         <figure style="opacity: 0; -webkit-transform: none;">16</figure>
         <figure style="opacity: 0; -webkit-transform: none;">17</figure>
         <figure style="opacity: 0; -webkit-transform: none;">18</figure>
         <figure style="opacity: 0; -webkit-transform: none;">19</figure>
         <figure style="opacity: 0; -webkit-transform: none;">20</figure>
      </div> -->
   </section>

   <div id="info"></div>

      <script>
         var Util = {
            createElement : function (tag, details) {
               var element = document.createElement(tag);
               Util._setProps(element, details);
               return element;
            },

            _setProps : function(element, details, propPrefix) {
               var objProps = Object.getOwnPropertyNames(details);
               objProps.forEach(function(propName, index, array) {
                  propDetails = Object.getOwnPropertyDescriptor(details, propName);
                  //for the moment only support one level of recursion for
                  //nested object in details
                  if('object' === typeof propDetails.value && !propPrefix) {
                     Util._setProps(element, propDetails.value, propName);
                  } else {
                     if(propPrefix) {
                        element[propPrefix][propName] = propDetails.value;
                     } else {
                        element[propName] = propDetails.value;      
                     }
                  }
               });
            }
         };

         function PeoplePicker ( names, container ) {


            var panels = [];
            var carousel;
            var panelCount = names.length;
            var panelSize = container.offsetHeight;
            var panelTheta = 360 / panelCount;

            // do some trig to figure out how big the carousel
            // is in 3D space
            var radius = Math.round( ( panelSize / 2) / Math.tan( Math.PI / panelCount ) );

            names.forEach(function(details, index, array) {
               var panel = new Panel(details, index * panelTheta, radius);
               panels.push(panel);
            }, this);

            carousel = Util.createElement('div', {"id":"carousel", "style": {"-webkit-transform" : "translateZ(-" + radius +"px) rotateX(0deg)"}});
            panels.forEach(function(panel, index, array) {
               carousel.appendChild(panel.element);
            }, carousel);
            container.appendChild(carousel);
         };

         function Panel(details, angle, radius) {
            this.element = Util.createElement('figure', {"style": {'opacity' : 1, 'backgroundColor' : 'hsla(' + angle + ', 100%, 50%, 0.8)', '-webkit-transform' : 'rotateX(' + angle + 'deg) translateZ(' + radius + 'px)'}, 'innerHTML' : details.name});
         };



         var init = function() {
            var names = [];
            for(var i = 1; i <= 30; i++) {
               names.push({'name': i});
            }
            var pp = new PeoplePicker(names, document.getElementById('container'));


            document.getElementById('carousel').addEventListener("webkitTransitionEnd", animationend, false);

            document.getElementsByTagName('body')[0].addEventListener('mousedown', mousedown, false);
            document.getElementsByTagName('body')[0].addEventListener('mouseup', mouseup, false);
            //THis doesn't capture leaving
            document.getElementsByTagName('body')[0].addEventListener('mouseout', mouseup, true);
            //document.getElementsByTagName('body')[0].addEventListener('mouseover', mouseup, true);

            document.getElementsByTagName('body')[0].addEventListener('dblclick', animate, true);
         };

         function Wrapper(container) {
            this.container;
            this.element;
            var lastmove = 0;
            function startTracking() {

            }

            function stopTracking() {

            }

            this.track = function (evt) {
               var element = document.getElementById('carousel');
               var currVal = element.style[ '-webkit-transform' ].match('rotateX\\(([-]?\\d+)')[1];
               //get current value 
               if(evt.clientY < lastmove) {
                  currVal++;
               } else  if(evt.clientY > lastmove) {
                  currVal--;
               }
               element.style[ '-webkit-transform' ] = 'translateZ(-288px) rotateX(' + currVal + 'deg)';
               lastmove = evt.clientY;
            }
         }



         //    //Step two is to take into account upwards thrust
         //    //document.getElementById('force-wrapper').addEventListener('mouseout',  ,false);
         //    document.getElementById('force-wrapper').addEventListener('mousedown', this.start ,false);
         //    //attach the mouse up to the document rather than this object
         //    document.getElementById('force-wrapper').addEventListener('mouseup', this.stop ,false);
         // };

         var lastmove = 0;
         function movemouse(evt) {
            document.getElementById('info').innerHTML = "screenX:" + evt.screenX +
               "screenY:" +evt.screenY + 
               "ClientX:" +evt.clientX +
               "ClientY:" +evt.clientY +
               "lastmove:" + lastmove;
            var element = document.getElementById('carousel');
            var currVal = element.style[ '-webkit-transform' ].match('rotateX\\(([-]?\\d+)')[1];
            //get current value 
            if(evt.clientY < lastmove) {
               currVal++;
            } else  if(evt.clientY > lastmove) {
               currVal--;
            }
            element.style[ '-webkit-transform' ] = 'translateZ(-288px) rotateX(' + currVal + 'deg)';
            lastmove = evt.clientY;
         };


         function inertiaDegrees(time, distance) {
            // inertia distance = (moveDistance * timeSeconds) + (numberOfPanels * weight per panel)
            //time seconds quicker = greater

            //we want to keep it less that 5 rotations i.e 5 * 360
         }

         function mousedown(evt) {
            document.getElementsByTagName('body')[0].className = "";
            document.getElementsByTagName('body')[0].addEventListener('mousemove', movemouse, false);
         }

         function mouseup(evt) {
            document.getElementsByTagName('body')[0].className = "animation3";
            document.getElementsByTagName('body')[0].removeEventListener('mousemove', movemouse, false);
         }

         function getRandomInt (min, max) {
           return Math.floor(Math.random() * (max - min + 1)) + min;
         }

         function roundToMultiple(numToRound, multiple) 
         { 
            if(multiple == 0) 
            { 
               return numToRound; 
            } 

            var remainder = numToRound % multiple;
            if (remainder == 0)
               return numToRound;
            return numToRound + multiple - remainder;
         } 

         function animate() {
            //Get a random place to go to
            var rand = getRandomInt(0, 1080);
            //round to the nearest angle for each face
            var rotation = roundToMultiple(rand, 40);
            document.getElementById('info').innerHTML = rotation;
            var element = document.getElementById('carousel');
            element.style[ '-webkit-transform' ] = 'translateZ(-288px) rotateX(' + rotation + 'deg)';
         }
         function animationend() {
            document.getElementById('info').innerHTML = "Animation finished";
         }




         window.addEventListener( 'DOMContentLoaded', init, false);

         //add remote storage so it works across any pc

         //Grow animation that will show description of team once selected

         //when animation finishes moving the 

         //at the end all tiles move across the screen showing the description text and team name
         //use the sounds from MSPinball when going through frames

        //humour to make the wheel spin one more time


         // When spinning capture direction and velocity

         //{'direction':'', start:'', stop:'', delta:'', velocity:''}

         //save function with local storage

               //get the inertial to apply based on movement
               //round the move to the next unselected person
               //choose a random easing
         // zoom wheel out whilst spining and zoom in on selected name
      </script>
   </body>
</html>